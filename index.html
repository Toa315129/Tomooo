<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TOMOPHOTO | Mall Booth</title>

<style>
:root{
    --dark:#2a1a12;
    --brown:#5b3a29;
    --brown-soft:#8c6b4e;
    --cream:#f4eee8;
    --frame:#d8c6b8;
}

*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:Arial, Helvetica, sans-serif;
    user-select:none;
}

body{
    background:var(--dark);
    width:100vw;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
}

/* ===== BOOTH ===== */
.booth{
    width:460px;
    height:92vh;
    max-height:900px;
    background:var(--cream);
    border-radius:28px;
    padding:22px;
    box-shadow:0 30px 70px rgba(0,0,0,.6);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    color:var(--brown);
}

/* ===== HEADER ===== */
.header{
    text-align:center;
}
.header h1{
    font-size:24px;
    letter-spacing:6px;
}
.header p{
    font-size:11px;
    opacity:.6;
}

/* ===== CAMERA ===== */
.camera-box{
    position:relative;
    border:6px solid var(--brown);
    border-radius:22px;
    overflow:hidden;
}
video{
    width:100%;
    display:block;
}
.countdown{
    position:absolute;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    font-size:160px;
    font-weight:bold;
    color:#fff;
    background:rgba(0,0,0,.35);
    text-shadow:0 0 25px black;
}

/* ===== PREVIEW (‡πÄ‡∏û‡∏¥‡πà‡∏°) ===== */
.preview-row{
    display:flex;
    justify-content:space-between;
    margin-top:10px;
}
.preview{
    width:30%;
    aspect-ratio:3/4;
    background:#e8dfd7;
    border-radius:12px;
    border:3px solid var(--frame);
    overflow:hidden;
}
.preview img{
    width:100%;
    height:100%;
    object-fit:cover;
}

/* ===== CONTROLS ===== */
.controls{
    display:flex;
    justify-content:space-around;
    margin-top:14px;
}
.btn{
    width:78px;
    height:78px;
    border-radius:50%;
    border:none;
    background:radial-gradient(circle at top,#a98a6a,var(--brown-soft));
    color:white;
    font-size:11px;
    cursor:pointer;
}
.btn:disabled{
    opacity:.35;
    cursor:not-allowed;
}

/* ===== RESULT ===== */
.result{
    display:flex;
    justify-content:center;
}
canvas{
    width:100%;
    border-radius:18px;
    border:5px solid var(--brown);
    display:none;
    background:#fff;
}

/* ===== FOOTER ===== */
.footer{
    text-align:center;
    font-size:10px;
    opacity:.6;
}
</style>
</head>

<body>

<div class="booth">

    <div class="header">
        <h1>TOMOPHOTO</h1>
        <p>MALL PHOTO BOOTH</p>
    </div>

    <div class="camera-box">
        <video id="video" autoplay playsinline></video>
        <div class="countdown" id="countdown">3</div>
    </div>

    <!-- PREVIEW (‡πÄ‡∏û‡∏¥‡πà‡∏°) -->
    <div class="preview-row">
        <div class="preview"><img id="p1"></div>
        <div class="preview"><img id="p2"></div>
        <div class="preview"><img id="p3"></div>
    </div>

    <div class="controls">
        <button class="btn" id="startBtn">‚óè<br>START</button>
        <button class="btn" id="saveBtn" disabled>‚¨á<br>SAVE</button>
        <button class="btn" id="resetBtn" disabled>‚Ü∫<br>RESET</button>
    </div>

    <div class="result">
        <canvas id="strip"></canvas>
    </div>

    <div class="footer">¬© TOMOPHOTO</div>
</div>

<script>
const video = document.getElementById("video");
const countdownEl = document.getElementById("countdown");
const startBtn = document.getElementById("startBtn");
const saveBtn = document.getElementById("saveBtn");
const resetBtn = document.getElementById("resetBtn");
const strip = document.getElementById("strip");

const previews = [
    document.getElementById("p1"),
    document.getElementById("p2"),
    document.getElementById("p3")
];

const stripCtx = strip.getContext("2d");
const tempCanvas = document.createElement("canvas");
const tempCtx = tempCanvas.getContext("2d");

let photos = [];
const TOTAL = 3;

/* CAMERA */
navigator.mediaDevices.getUserMedia({ video:{ facingMode:"user" } })
.then(stream => video.srcObject = stream);

/* UTIL */
const sleep = ms => new Promise(r=>setTimeout(r,ms));

async function runCountdown(){
    countdownEl.style.display="flex";
    for(let i=3;i>0;i--){
        countdownEl.textContent=i;
        await sleep(1000);
    }
    countdownEl.style.display="none";
}

function capture(index){
    tempCanvas.width = video.videoWidth;
    tempCanvas.height = video.videoHeight;
    tempCtx.drawImage(video,0,0);
    const img = tempCanvas.toDataURL("image/png");
    photos.push(img);
    previews[index].src = img;   // üëà ‡πÄ‡∏û‡∏¥‡πà‡∏° preview
}

async function startBooth(){
    photos = [];
    previews.forEach(p=>p.src="");
    strip.style.display="none";

    startBtn.disabled = true;
    saveBtn.disabled = true;
    resetBtn.disabled = true;

    for(let i=0;i<TOTAL;i++){
        await runCountdown();
        capture(i);
        await sleep(500);
    }

    buildStrip();
    startBtn.disabled = false;
}

function buildStrip(){
    const w = tempCanvas.width;
    const h = tempCanvas.height;
    const pad = 24;
    const headerH = 120;

    strip.width = w + pad*2;
    strip.height = headerH + h*TOTAL + pad*(TOTAL+1);

    stripCtx.fillStyle="#fff";
    stripCtx.fillRect(0,0,strip.width,strip.height);

    // üëá ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß TOMOPHOTO
    stripCtx.fillStyle="#5b3a29";
    stripCtx.font="bold 42px Arial";
    stripCtx.textAlign="center";
    stripCtx.fillText("TOMOPHOTO", strip.width/2, 70);

    photos.forEach((src,i)=>{
        const img = new Image();
        img.onload = ()=>{
            const y = headerH + pad + i*(h+pad);
            stripCtx.fillStyle="#eee";
            stripCtx.fillRect(pad-6,y-6,w+12,h+12);
            stripCtx.drawImage(img,pad,y,w,h);

            if(i === TOTAL-1){
                strip.style.display="block";
                saveBtn.disabled = false;
                resetBtn.disabled = false;
            }
        };
        img.src = src;
    });
}

startBtn.onclick = startBooth;

saveBtn.onclick = ()=>{
    const a = document.createElement("a");
    a.download = "TOMOPHOTO.png";
    a.href = strip.toDataURL("image/png");
    a.click();
};

resetBtn.onclick = ()=>{
    photos = [];
    previews.forEach(p=>p.src="");
    strip.style.display="none";
    saveBtn.disabled = true;
    resetBtn.disabled = true;
};
</script>

</body>
</html>
